(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/equipment/equipment"],{"0cf6":function(e,t,n){"use strict";(function(e,t){var a=n("47a9");n("8ed8"),n("c891"),n("861b");a(n("3240"));var i=a(n("27dc"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"27dc":function(e,t,n){"use strict";n.r(t);var a=n("c5e9"),i=n("a34c");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("fcaa");var r=n("828b"),u=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=u.exports},a34c:function(e,t,n){"use strict";n.r(t);var a=n("c542"),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},b1ee:function(e,t,n){},c542:function(e,t,n){"use strict";(function(e){var a=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n("7eb4")),o=a(n("ee10"));function r(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw o}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var c={onLoad:function(){this.accesstoken=e.getStorageSync("accesstoken"),this.equipment_type=e.getStorageSync("equipment_type")},onReady:function(){this.getBanner()},onShow:function(){var e=this;console.log("this.keyNum"+this.keyNum),this.keyNum-0==1?this.keyNum=2:this.keyNum=1,this.syncApiData(),this.timer=setInterval((function(){console.log("progress_flag："+e.progress_flag),e.syncApiData(),e.keyNum-0==1?e.keyNum=2:e.keyNum=1,console.log("this.keyNum"+e.keyNum)}),6e4)},onHide:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onUnload:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},data:function(){return{keyNum:1,progress_flag:0,progress_state:!0,equipment_reminder_type:!0,timer:null,accesstoken:"",equipment_type:"",temporary_equipment:[],equipment_composition:[],foldFlag:[],equipment:{},swiper_list:[],equipment_data:[],testdata:[{mn:"MYHJ00002021000080011101",name:"纺织检测中心01纺织检测中纺织检测中心01纺织检测中纺织检测中心01纺织检测中纺织检测中心01纺织检测中心01纺织检测中心01纺织检测中心01",data:"15.66"},{mn:"MYHJ00002021000080011102",name:"纺织检测中心02",data:"14"},{mn:"MYHJ00002021000080011103",name:"纺织检测中心03",data:"63.66"},{mn:"MYHJ00002021000080011104",name:"纺织检测中心04",data:"70.5"},{mn:"MYHJ00002021000080011105",name:"纺织检测中心05",data:"90.12"},{mn:"MYHJ00002021000080011106",name:"纺织检测中心06",data:"101.55"},{mn:"MYHJ00002021000080011107",name:"纺织检测中心07",data:"150"},{mn:"MYHJ00002021000080011108",name:"纺织检测中心08",data:"362"},{mn:"MYHJ00002021000080011109",name:"纺织检测中心09",data:"19.22"}]}},methods:{syncApiData:function(){var t=this;return(0,o.default)(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.equipment_composition=e.getStorageSync("equipment_composition"),""!=t.equipment_composition&&null!=t.equipment_composition){n.next=4;break}return n.next=4,t.syncLoginEquipmentData();case 4:t.dataFiltration(),t.temporary_equipment=[];case 6:case"end":return n.stop()}}),n)})))()},dataFiltration:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n,a,o;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.equipment_reminder_type=!1,n=r(e.equipment_composition),t.prev=2,n.s();case 4:if((a=n.n()).done){t.next=13;break}return o=a.value,e.equipment={},e.equipment.name=o.name,e.equipment.mn=o.mn,t.next=11,e.syncGetEquipmentData(o.mn);case 11:t.next=4;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](2),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:e.equipment_data=e.temporary_equipment,console.log("equiApment_data\n"+JSON.stringify(e.equipment_data));case 23:case"end":return t.stop()}}),t,null,[[2,15,18,21]])})))()},syncLoginEquipmentData:function(){var t=this;return new Promise((function(n,a){var i=e.getStorageSync("user_id"),o=e.getStorageSync("password");""!=i&&""!=o?(t.equipment_reminder_type=!1,e.request({url:"https://voc.16861.com/appapi?",data:{m:"app",username:i,password:o},method:"GET",header:{"Content-Type":"application/json"},success:function(i){for(var o in 200!=i.statusCode&&(console.log("--------"),console.log("网络请求失败"),a("error")),console.log("进入"),e.setStorageSync("accesstoken",i.data.accesstoken),t.equipment_type=i.data.roleid,t.equipment_composition=i.data.devs,e.setStorageSync("equipment_composition",i.data.devs),e.setStorageSync("equipment_type",i.data.roleid),t.equipment_composition)t.foldFlag.push(!1);console.log("设备型号组数据请求----"+JSON.stringify(t.equipment_composition)),n("success")},fail:function(e){console.log(e),a("error")}})):t.equipment_reminder_type=!0}))},syncGetEquipmentData:function(t){var n=this;return new Promise((function(a,i){e.request({url:"https://voc.16861.com/appapi",data:{m:"app",a:"data",mn:t,size:1,type:"8"==n.equipment_type?"2":"1",accesstoken:n.accesstoken},method:"GET",header:{"Content-Type":"application/json"},success:function(e){if(200!=e.statusCode)return console.log("--------"),console.log("网络请求失败"),void i("error");if(null!=e.data.cp){null!=e.data.cp[0].a99054&&(n.equipment.data_name="TVOC:",n.equipment.data=JSON.stringify(e.data.cp[0].a99054.Avg),n.equipment.factorNumber="a99054",n.equipment.unit="mg/m3"),null!=e.data.cp[0].a24088&&(n.equipment.data_name=e.data.cp[0].a24088.Name,n.equipment.data=JSON.stringify(e.data.cp[0].a24088.Rtd),n.equipment.factorNumber="a24088",n.equipment.unit=e.data.cp[0].a24088.Unit),null!=e.data.cp[0].ec0000&&(n.equipment.data_name=e.data.cp[0].ec0000.Name,n.equipment.data=JSON.stringify(e.data.cp[0].ec0000.Rtd),n.equipment.factorNumber="ec0000",n.equipment.unit=e.data.cp[0].ec0000.Unit);var t=e.data.cp[0].DataTime;n.equipment.year_time=t.slice(0,4)+"."+t.slice(4,6)+"."+t.slice(6,8),n.equipment.minute_time=t.slice(8,10)+":"+t.slice(10,12),n.temporary_equipment.push(n.equipment),a("success")}else console.log("空数据")},fail:function(e){console.log(e),i("error")}})}))},real_time_data:function(t,n,a,i,o,r){e.navigateTo({url:"../gasdata/gasdata?mn="+t+"&timeType="+n+"&equipmentType="+a+"&accesstoken="+i+"&factorName="+o+"&factorNumber="+r,success:function(){console.log("成功")},fail:function(){console.log("失败")}})},history:function(t,n,a){e.navigateTo({url:"../gasdata/history?mn="+t+"&accesstoken="+n+"&equipmentType="+a,success:function(){console.log("成功")},fail:function(e){console.log("失败"+JSON.stringify(e))}})},getBanner:function(){var t=this;e.request({url:"https://voc.16861.com/appapi.php?m=news&a=api&fenlei=2",method:"GET",data:{},success:function(e){var n=e.data.result.data;for(var a in n)t.swiper_list.push("https://voc.m-excel.cn/"+n[a].pic)},fail:function(){},complete:function(){}})},fold_drop:function(e,t){this.foldFlag[e]=!t,this.$forceUpdate()}}};t.default=c}).call(this,n("df3c")["default"])},c5e9:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var a={uSwiper:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-swiper/u-swiper")]).then(n.bind(null,"36d5"))},uniTitle:function(){return n.e("uni_modules/uni-title/components/uni-title/uni-title").then(n.bind(null,"dda6"))},uniTag:function(){return n.e("uni_modules/uni-tag/components/uni-tag/uni-tag").then(n.bind(null,"ccd1"))}},i=function(){var e=this.$createElement;this._self._c},o=[]},fcaa:function(e,t,n){"use strict";var a=n("b1ee"),i=n.n(a);i.a}},[["0cf6","common/runtime","common/vendor"]]]);