{"version":3,"sources":["uni-app:///main.js","webpack:///D:/DevelopmentProject/uniapp/huanbaoyun/pages/chat/chat.nvue?6d6c","webpack:///D:/DevelopmentProject/uniapp/huanbaoyun/pages/chat/chat.nvue?215b","webpack:///D:/DevelopmentProject/uniapp/huanbaoyun/pages/chat/chat.nvue?ceb1","webpack:///D:/DevelopmentProject/uniapp/huanbaoyun/pages/chat/chat.nvue?cf7c","uni-app:///pages/chat/chat.nvue","webpack:///D:/DevelopmentProject/uniapp/huanbaoyun/pages/chat/chat.nvue?8b7c","webpack:///D:/DevelopmentProject/uniapp/huanbaoyun/pages/chat/chat.nvue?e5c7","webpack:///D:/DevelopmentProject/uniapp/huanbaoyun/pages/chat/chat.nvue?3bac","webpack:///D:/DevelopmentProject/uniapp/huanbaoyun/pages/chat/chat.nvue?2f42"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":"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","file":"pages/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/uni-stat/dist/uni-stat.es.js';\nimport Vue from 'vue'\nimport Page from './pages/chat/chat.nvue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.nvue?vue&type=template&id=6e1957d8&\"\nvar renderjs\nimport script from \"./chat.nvue?vue&type=script&lang=js&\"\nexport * from \"./chat.nvue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.nvue?vue&type=style&index=0&lang=css&\"\nimport style1 from \"./chat.nvue?vue&type=style&index=1&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat.nvue\"\nexport default component.exports","export * from \"-!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=template&id=6e1957d8&\"","var components\ntry {\n  components = {\n    msg: function() {\n      return import(\n        /* webpackChunkName: \"components/msg/msg\" */ \"@/components/msg/msg.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=script&lang=js&\"","<style>\n  view,\n  label,\n  swiper-item,\n  scroll-view {\n    display:flex;\n    flex-direction:column;\n    flex-shrink: 0;\n    flex-grow: 0;\n    flex-basis: auto;\n    align-items: stretch;\n    align-content: flex-start;\n  }\n  view,\n  image,\n  input,\n  scroll-view,\n  swiper,\n  swiper-item,\n  text,\n  textarea,\n  video {\n    position: relative;\n    border: 0px solid #000000;\n    box-sizing: border-box;\n  }\n  swiper-item {\n    position: absolute;\n  }\n  button {\n    margin: 0;\n  }\n</style>\n<template>\r\n\t<view class=\"page\" :style=\"{height:wHeight+'px'}\">\r\n\t\t<list @touchstart=\"touchList\" :show-scrollbar=\"false\"\r\n\t\t\t:style=\"{height:chatListHeight+'px'}\">\r\n\t\t\t<cell v-for=\"(data,index) in msgList\" :key=\"index\">\r\n\t\t\t\t<msg :data=\"data\" :self=\"mineId==data.fromId\" ref=\"msg\"></msg>\r\n\t\t\t</cell>\r\n\t\t\t<cell v-if=\"msgList.length===0\">\r\n\t\t\t\t<text class=\"null\">- 暂无聊天记录 -</text>\r\n\t\t\t</cell>\r\n\t\t</list>\r\n\t\t<view class=\"inputBox\" @click=\"stop\">\r\n\t\t\t<!-- <text class=\"ico voice\">语音</text> -->\r\n\t\t\t<view class=\"textarea-box\">\r\n\t\t\t\t<textarea v-model=\"text\"\r\n\t\t\t\t\t@input=\"input\" \r\n\t\t\t\t\treturn-key-type=\"send\" \r\n\t\t\t\t\t:singleline=\"true\" \r\n\t\t\t\t\t@linechange=\"linechange\" \r\n\t\t\t\t\t:style=\"{height:textareaHeight+'px'}\" \r\n\t\t\t\t\t:show-confirm-bar=\"false\" \r\n\t\t\t\t\tmaxlength=\"100\" \r\n\t\t\t\t\tclass=\"textarea\"\r\n\t\t\t\t\t@focus=\"focus\"\r\n\t\t\t\t\t:adjust-position=\"false\"\r\n\t\t\t\t/>\r\n\t\t\t</view>\r\n\t\t\t<text @click=\"send\" class=\"ico send\">发送</text>\r\n\t\t\t<!-- <uni-icons @click=\"sendImg\" type=\"camera-filled\" size=\"26\"></uni-icons> 待续 -->\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tconst dom = weex.requireModule('dom') || {};\r\n\timport sql from '@/common/sql.js'\r\n\texport default {\r\n\t\tcomputed:{\r\n\t\t\tchatListHeight(){\r\n\t\t\t\treturn this.wHeight - this.keyboardHeight- 66 - (this.textareaHeight -36)\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tmsgList(newValue, oldValue) {\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tmsgList:[],\r\n\t\t\t\tcurrentUserId:false,//正在聊的用户id\t\t\r\n\t\t\t\tmineId:false,\r\n\t\t\t\tkeyboardHeight:0,\r\n\t\t\t\ttext:\"\",\r\n\t\t\t\twHeight:\"\",\r\n\t\t\t\ttextareaHeight:26,\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.wHeight = uni.getSystemInfoSync().windowHeight\r\n\t\t\tuni.onKeyboardHeightChange(({height})=>{\r\n\t\t\t\tconsole.log(height);\r\n\t\t\t\tthis.keyboardHeight = height\r\n\t\t\t})\r\n\t\t},\r\n\t\tasync onLoad({currentUserId,mineId,username}) {\r\n\t\t\tthis.currentUserId = currentUserId\r\n\t\t\tthis.mineId = mineId\r\n\t\t\tif(username){\r\n\t\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\t\ttitle:username\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t//标已读\r\n\t\t\tlet aa = await sql.executeSql(`UPDATE msg SET \"isRead\" = 1 WHERE \"fromId\" = \"${currentUserId}\"`);\r\n\t\t\tconsole.log(aa);\r\n\t\t\tconsole.log({currentUserId,mineId});\r\n\t\t\tawait this.getUnReadNum()//设置 左上角未读消息数 数量\r\n\t\t\t\r\n\t\t\t//加载消息\r\n\t\t\tthis.getNewMsg()//\r\n\t\t\t\r\n\t\t\t//收到消息后处理\r\n\t\t\tuni.$on('handlePush',async ({payload})=>{\r\n\t\t\t\tif(payload.fromId==this.currentUserId){\r\n\t\t\t\t\tthis.msgList.push({\r\n\t\t\t\t\t\ttext:payload.text,\r\n\t\t\t\t\t\ttoId:payload.toId,\r\n\t\t\t\t\t\tfromId:payload.fromId,\r\n\t\t\t\t\t\ttimestamp:payload.timestamp,\r\n\t\t\t\t\t\tisRead:1\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.showLast()\r\n\t\t\t\t\t//更新用户列表上的时间与消息内容\r\n\t\t\t\t\tlet res = await sql.executeSql(`\r\n\t\t\t\t\t\tUPDATE \r\n\t\t\t\t\t\t\t\"userList\"\r\n\t\t\t\t\t\tSET \r\n\t\t\t\t\t\t\t\"num\" = 0,\r\n\t\t\t\t\t\t\t\"text\" = \"${payload.text}\",\r\n\t\t\t\t\t\t\t\"timestamp\" = ${payload.timestamp}\r\n\t\t\t\t\t\tWHERE \r\n\t\t\t\t\t\t\t\"_id\" = \"${payload.fromId}\"\r\n\t\t\t\t\t`);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tawait this.getUnReadNum()//设置 左上角未读消息数 数量\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t//获取当前对话用户昵称  调试使用\r\n\t\t\t/* uniCloud.callFunction({\r\n\t\t\t\tname:'uchat',\r\n\t\t\t\tdata:{\r\n\t\t\t\t\troute:\"getUserName\",\r\n\t\t\t\t\twhere:{_id:this.currentUserId}\r\n\t\t\t\t},\r\n\t\t\t\tsuccess:({result:{code,data}})=>{\r\n\t\t\t\t\tconsole.log(code);\r\n\t\t\t\t\tif(code!=1000){\r\n\t\t\t\t\t\tuni.navigateTo({url:'/pages/login/login'})\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\t\t\ttitle:data\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tfail(err) {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: 'err',\r\n\t\t\t\t\t\t\tcontent: JSON.stringify(err),\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}) */\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tasync getNewMsg(){\r\n\t\t\t\tlet {data} = await sql.selectSql(`select * from msg WHERE \r\n\t\t\t\t\t(\"fromId\" = \"${this.currentUserId}\" AND \"toId\" = \"${this.mineId}\") \r\n\t\t\t\t\tOR \r\n\t\t\t\t\t(\"toId\" = \"${this.currentUserId}\" AND \"fromId\" = \"${this.mineId}\") \r\n\t\t\t\t\tORDER BY \"timestamp\" DESC\r\n\t\t\t\t`);\r\n\t\t\t\tconsole.log('getNewMsg',data,this.mineId,this.currentUserId);\r\n\t\t\t\tthis.msgList = data.reverse()\r\n\t\t\t\tthis.showLast(false)\r\n\t\t\t},\r\n\t\t\ttouchList(){\r\n\t\t\t\tuni.hideKeyboard()\r\n\t\t\t},\r\n\t\t\tinput(){\r\n\t\t\t\tif(uni.getSystemInfoSync().platform == \"ios\" && this.text.indexOf(\"\\n\") >= 0) {\r\n\t\t\t\t\tconsole.log( \"中有\\n\");\r\n\t\t\t\t\tthis.text = this.text.substring(0,this.text.length-2);\r\n\t\t\t\t\tif(this.text) this.send()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync send(){\r\n\t\t\t\tif(!this.text) return false;\r\n\t\t\t\tconst text = this.text\r\n\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\tname:'uchat',\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\troute:\"sendMsg\",\r\n\t\t\t\t\t\ttext,\r\n\t\t\t\t\t\tuserInfo:uni.getStorageSync(\"userInfo\"),\r\n\t\t\t\t\t\ttoId:this.currentUserId,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess:async ({result:{code,data}})=>{\r\n\t\t\t\t\t\tconsole.log(code);\r\n\t\t\t\t\t\tif(!uni.getStorageSync('userInfo')){\r\n\t\t\t\t\t\t\tuni.navigateTo({url:'/pages/login/login'})\r\n\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(data.code==20001){\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '错误',\r\n\t\t\t\t\t\t\t\tcontent: e.result.msg+\"或对方没在云打包或自定义的基座运行\",\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t\tconfirmText: '关闭'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//更新用户列表上的时间与消息内容\r\n\t\t\t\t\t\tlet res = await sql.executeSql(`\r\n\t\t\t\t\t\t\tUPDATE \r\n\t\t\t\t\t\t\t\t\"userList\"\r\n\t\t\t\t\t\t\tSET \r\n\t\t\t\t\t\t\t\t\"num\" = 0,\r\n\t\t\t\t\t\t\t\t\"text\" = \"${text}\",\r\n\t\t\t\t\t\t\t\t\"timestamp\" = ${Date.now()}\r\n\t\t\t\t\t\t\tWHERE \r\n\t\t\t\t\t\t\t\t\"_id\" = \"${this.currentUserId}\"\r\n\t\t\t\t\t\t`);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: 'err',\r\n\t\t\t\t\t\t\t\tcontent: JSON.stringify(err),\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tthis.msgList.push({\r\n\t\t\t\t\ttext:this.text,\r\n\t\t\t\t\ttoId:this.currentUserId,\r\n\t\t\t\t\tfromId:this.mineId,\r\n\t\t\t\t\ttimestamp:Date.now()\r\n\t\t\t\t})\r\n\t\t\t\tlet a = await sql.executeSql([\r\n\t\t\t\t\t\"create table if not exists msg('isRead' INTEGER,'fromId' CHAR(32),'toId' CHAR(32),'text' VARCHAR(255),'timestamp' INTEGER)\",\r\n\t\t\t\t\t\"insert into msg values(1,'\"+this.mineId+\"','\"+this.currentUserId+\"','\"+this.text+\"','\"+Date.now()+\"')\",\r\n\t\t\t\t]);\r\n\t\t\t\tconsole.log(a);\r\n\t\t\t\t\r\n\t\t\t\tthis.$nextTick(()=>{\r\n\t\t\t\t\tthis.text = ''\r\n\t\t\t\t\tthis.textareaHeight = 26\r\n\t\t\t\t})\r\n\t\t\t\tthis.showLast()\r\n\t\t\t},\r\n\t\t\tasync getUnReadNum(){ //设置 左上角未读消息数 数量\r\n\t\t\t\tlet {data:[data]} = await sql.selectSql(`\r\n\t\t\t\t\tselect  count(*) as num\r\n\t\t\t\t\tfrom msg\r\n\t\t\t\t\tWHERE isRead = 0\r\n\t\t\t\t`);\r\n\t\t\t\tif(!data){\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tlet num = data.num\r\n\t\t\t\tconsole.log(num);\r\n\t\t\t\t\r\n\t\t\t\tplus.webview.currentWebview().setTitleNViewButtonStyle(0, {\r\n\t\t\t\t\ttext: num !== 0?num:\"\",\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tshowLast(animated=true){\r\n\t\t\t\tif(this.msgList.length){\r\n\t\t\t\t\tthis.$nextTick(()=>{\r\n\t\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\t\tconst target = this.$refs.msg[this.msgList.length-1];\r\n\t\t\t\t\t\t\tdom.scrollToElement(target, {animated});/* ,offset:0 */\r\n\t\t\t\t\t\t},100)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlinechange(e){\r\n\t\t\t\t//console.log(e.detail);\r\n\t\t\t\tlet {height,lineCount} = e.detail\r\n\t\t\t\t\r\n\t\t\t\t//console.log(height,lineCount);\r\n\t\t\t\t\r\n\t\t\t\tif(lineCount===1){\r\n\t\t\t\t\tthis.textareaHeight = 26\r\n\t\t\t\t}\r\n\t\t\t\tif(lineCount!==1&&height<=100){\r\n\t\t\t\t\tconsole.log('来来来1');\r\n\t\t\t\t\tthis.textareaHeight = height\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfocus(e){\r\n\t\t\t\t//console.log(e.detail.height);\r\n\t\t\t\t//this.keyboardHeight = e.detail.height\r\n\t\t\t},\r\n\t\t\tstop(event){\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tbeforeDestroy() {\r\n\t\t\t//uni.$off('handlePush')\r\n\t\t},\r\n\t\tonNavigationBarButtonTap() {\r\n\t\t\tuni.navigateBack()\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.page{\r\n\tbackground-color: #F1F1F1;\r\n}\r\n.inputBox{\r\n\tflex-direction: row;\r\n\tpadding:6px 20rpx;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n\tborder-top-width: 1rpx;\r\n\tborder-top-style: solid;\r\n\tborder-top-color:#BBBBBB;\r\n\t//height: 66px;\r\n}\r\n.textarea-box{\r\n\tbackground-color: #FFFFFF;\r\n\tpadding:20rpx;\r\n\twidth: 600rpx;\r\n\tborder-radius: 10px;\r\n}\r\n.textarea{\r\n\twidth: 580rpx;\r\n\tpadding: 0;\r\n\tline-height: 42px;\r\n\tbackground-color: #FFFFFF;\r\n\tcolor: #666666;\r\n\t//padding: 20rpx;\r\n\tfont-size: 32rpx;\r\n\tborder-radius: 10px;\r\n}\r\n.ico{\r\n\tmargin:10rpx 16rpx;\r\n\theight: 30px;\r\n\tline-height: 30px;\r\n}\r\n.voice{\r\n\t//background-color: #2C405A;\r\n}\r\n.send{\r\n\tbackground-color: #4CD964;\r\n\tpadding: 0 18rpx;\r\n\tcolor: #FFFFFF;\r\n\tfont-size: 30rpx;\r\n\tborder-radius: 6px;\r\n}\r\n.null{\r\n\twidth: 750rpx;\r\n\theight: 100px;\r\n\tline-height: 100px;\r\n\tfont-size: 26rpx;\r\n\ttext-align: center;\r\n\tcolor: #999999;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1657862271766\n      var cssReload = require(\"D:/DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import mod from \"-!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=1&lang=scss&\"; export default mod; export * from \"-!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=1&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1657862276151\n      var cssReload = require(\"D:/DevelopmenTool/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}